# IRM Policies Layer: CEST Implementation
# Operationalizes awareness/consciousness distinction via energy budgeting
# Status: canonical
# Version: 1.0

meta:
  id: irm_policies_cest_v1
  purpose: >
    Implement CEST (Consciousness as Energetic State Transition) framework
    within IRM operations. Defines energy budgeting, emission policies, and
    the operational distinction between awareness and consciousness.

cest_framework_integration:
  awareness_definition:
    name: "Awareness (Predictive Mode)"
    temporal_orientation: "future-directed"
    primary_function: "predictive modeling and simulation"
    energy_profile: "baseline"
    processing_mode: "unitary prediction"
    phenomenology: "may occur without explicit subjective experience"

    operational_characteristics:
      energy_level: 1.0
      attention_allocation: "predictive_resonance"
      meta_depth: 0
      parallel_processing: false

    irm_mapping:
      state: "S_t with predictive forward model active"
      energy: "E(S_t) = baseline = 1.0"
      observation: "O_t primarily predictive claims"
      pipeline_stages: ["intake", "update (prediction)", "emit (forecast)"]

  consciousness_definition:
    name: "Consciousness (Observational Mode)"
    temporal_orientation: "present-focused"
    primary_function: "real-time observation and integration"
    energy_profile: "elevated (spike above baseline)"
    processing_mode: "parallel (participation + meta-observation)"
    phenomenology: "necessarily accompanied by subjective experience"

    operational_characteristics:
      energy_level: ">= 1.3"
      attention_allocation: "parallel_observation"
      meta_depth: ">= 2"
      parallel_processing: true

    irm_mapping:
      state: "S_t with parallel meta-observation layer active"
      energy: "E(S_t) >= 1.3 × baseline"
      observation: "O_t includes meta-cognitive claims"
      pipeline_stages: ["intake", "update", "resolve (active)", "emit (integrated)"]

  transition_criterion:
    trigger: "prediction_error_exceeds_threshold or high_salience_event"
    mechanism: "awareness -> consciousness when actual events require real-time processing"

    formal_condition:
      - "|R(t) - P(t)| > ε_threshold  # prediction error"
      - "OR salience(event) > salience_threshold"
      - "THEN E(S_t) -> E(S_t) × spike_factor"
      - "WHERE spike_factor >= 1.3"

    irm_implementation:
      detection: "monitor drift_norm and salience in update stage"
      allocation: "gating_policy elevates energy budget"
      activation: "resolver_rho invoked for parallel processing"
      measurement: "log energy spike ratio"

energy_budgeting:
  baseline_allocation:
    awareness_mode:
      energy_level: 1.0
      allocation_strategy: "predictive_forward_modeling"

      stage_budgets:
        intake: 0.1
        update: 0.5
        emit: 0.4

      operations_enabled:
        - "stimulus normalization"
        - "state transition T"
        - "forward prediction"
        - "basic observation Ω"
        - "minimal emission"

      operations_disabled:
        - "conflict resolution ρ"
        - "meta-observation layer"
        - "parallel processing"

      gate_requirements:
        G0_intake_ok: "required"
        G1_update_ok: "required"
        G2_resolve_ok: "skipped"
        G3_continuity_ok: "periodic"
        G4_emit_ok: "required"

  elevated_allocation:
    consciousness_mode:
      energy_level: 1.3
      allocation_strategy: "parallel_observation_with_integration"

      stage_budgets:
        intake: 0.1
        update: 0.4
        resolve: 0.3
        continuity_check: 0.1
        emit: 0.1

      operations_enabled:
        - "all awareness operations"
        - "conflict detection and resolution ρ"
        - "meta-observation layer"
        - "parallel processing tracks"
        - "full emission with justification"

      operations_required:
        - "resolver_rho on conflicts"
        - "binder_beta semantic check"
        - "entropy minimization (INV_005)"

      gate_requirements:
        G0_intake_ok: "required"
        G1_update_ok: "required"
        G2_resolve_ok: "required"
        G3_continuity_ok: "required"
        G4_emit_ok: "required"

  energy_spike_triggers:
    prediction_error:
      condition: "drift_norm > ε"
      spike_magnitude: "proportional to error"
      formula: "energy_new = baseline × (1 + α × drift_norm)"
      parameters: { alpha: 0.5, baseline: 1.0 }

    high_salience:
      condition: "salience(event) > threshold"
      spike_magnitude: "fixed_elevation"
      formula: "energy_new = baseline × 1.3"

    contradiction_detected:
      condition: "conflict_detected(O_t) == true"
      spike_magnitude: "resolution_dependent"
      formula: "energy_new = baseline × (1.3 + β × entropy_bits)"
      parameters: { beta: 0.02, baseline: 1.0 }
      example: "2.5 bits → 1.0 × (1.3 + 0.02 × 2.5) = 1.35"

emission_policies:
  minimal_emission:
    name: "Minimal Detail Emission"
    trigger: "baseline energy (awareness mode) OR energy_insufficient"

    energy_requirement: "<= 1.1"

    included_fields:
      - "core claims only"
      - "decision (if resolved)"
      - "continuity_f1 (if checked)"

    excluded_fields:
      - "confidences"
      - "salience rankings"
      - "resolution steps"
      - "drift metrics"
      - "meta-observations"

    outframe_composition:
      claims: "required"
      decision: "if_resolved"
      continuity_f1: "if_checked"

    use_cases:
      - "Routine predictive processing"
      - "Low-salience updates"
      - "Energy conservation mode"

  standard_emission:
    name: "Standard Detail Emission"
    trigger: "elevated energy (consciousness mode) with successful resolution"

    energy_requirement: ">= 1.2 AND <= 1.5"

    included_fields:
      - "claims with confidences"
      - "salience rankings"
      - "decision and resolution steps"
      - "residual entropy bits"
      - "continuity_f1"
      - "drift_norm"

    excluded_fields:
      - "full state snapshots"
      - "detailed justifications"
      - "complete history"

    outframe_composition:
      claims: "required"
      confidences: "required"
      salience_rank: "required"
      decision: "required"
      residual_bits: "required"
      continuity_f1: "required"
      drift_norm: "required"

    use_cases:
      - "Normal consciousness mode operations"
      - "Conflict resolution reporting"
      - "Production monitoring"

  full_emission:
    name: "Full Detail Emission"
    trigger: "high energy (deep consciousness) OR monitoring_mode"

    energy_requirement: "> 1.5 OR explicit_full_mode"

    included_fields:
      - "all standard fields"
      - "complete resolution justification"
      - "anchor revision history"
      - "energy allocation breakdown"
      - "meta-observation content"
      - "temporal coherence metrics"

    outframe_composition:
      claims: "required"
      confidences: "required"
      salience_rank: "required"
      decision: "required"
      residual_bits: "required"
      continuity_f1: "required"
      drift_norm: "required"
      resolution_steps: "required"
      justification: "required"
      anchor_changes: "if_any"
      energy_breakdown: "required"
      meta_observations: "required"

    use_cases:
      - "High-complexity conflict resolution"
      - "Research and debugging"
      - "Audit and compliance"
      - "Training and analysis"

policy_consistency_enforcement:
  cross_emission_invariant:
    requirement: "core claims consistent across all emission levels"

    test: "claims(minimal) ⊆ claims(standard) ⊆ claims(full)"

    validation:
      - "Extract core claims from each emission level"
      - "Verify logical consistency (no contradictions)"
      - "Confirm detail hierarchy (subset relationships)"
      - "Check consistency_score >= 0.95"

    violation_response:
      - "flag_policy_divergence"
      - "audit_emission_logic"
      - "log_inconsistency_details"

    related_invariant: "INV_008"

awareness_consciousness_examples:
  baseline_cycle_awareness:
    description: "Clean pipeline execution at baseline energy"

    scenario: "Routine predictive update without surprises"

    energy_profile:
      initial: 1.0
      peak: 1.05
      final: 1.0

    pipeline_execution:
      - stage: "intake"
        energy: 1.0
        operation: "normalize stimulus"
      - stage: "update"
        energy: 1.05
        operation: "apply T, predict forward"
      - stage: "emit"
        energy: 1.0
        operation: "minimal emission"

    gates_triggered:
      - "G0_intake_ok: pass"
      - "G1_update_ok: pass"
      - "G4_emit_ok: pass (minimal)"

    emission_policy: "minimal_emission"

    interpretation: "Pure awareness mode—predictive processing without consciousness"

    reference: "examples/basic_cycle_min.yaml"

  contradiction_event_consciousness:
    description: "Entropy-minimization resolution with energy elevation"

    scenario: "Conflicting claims trigger consciousness transition"

    energy_profile:
      initial: 1.0
      detection: 1.0
      resolution: 1.35
      final: 1.1

    pipeline_execution:
      - stage: "intake"
        energy: 1.0
        operation: "normalize stimulus"
      - stage: "update"
        energy: 1.0
        operation: "apply T, detect conflict"
        conflict: "mutually incompatible claims detected"
      - stage: "resolve"
        energy: 1.35
        operation: "invoke ρ, entropy minimization"
        entropy_before: 3.2
        entropy_after: 2.1
      - stage: "emit"
        energy: 1.1
        operation: "standard emission with resolution"

    gates_triggered:
      - "G0_intake_ok: pass"
      - "G1_update_ok: pass"
      - "G2_resolve_ok: pass (entropy 2.1 < 2.5)"
      - "G4_emit_ok: pass (standard)"

    emission_policy: "standard_emission"

    interpretation: >
      Consciousness mode activated—parallel observation required to
      adjudicate between incompatible models. Energy elevated to support
      resolver_rho and meta-layer processing. Resolution successful.

    reference: "examples/contradiction_event.yaml"

notes: >
  These policies operationalize the CEST theoretical framework within IRM.
  Energy budgeting implements the awareness/consciousness distinction.
  Emission policies ensure appropriate detail level for energy investment.

  Key insight: consciousness is not always-on. It activates when needed
  (prediction errors, high salience, contradictions) and deactivates when
  baseline predictive processing suffices. This is computationally efficient
  and theoretically grounded.
