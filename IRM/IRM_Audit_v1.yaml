# IRM Audit Pack — v1.0
# Scope: Post‑T3 end‑to‑end verification of the Internal Reality Model (T0..T3)
# Philosophy: structure over narrative; reproducible gates; variance bounds; rollback on breach

audit_pack:
  version: 1.0
  scope_layers: [T0_continuity_floor, T1_identity_lock, T2_continuity_loop, T3_world_skeleton]
  objectives:
    - verify structural continuity across layers without episodic dependence
    - bound prediction and contradiction entropy under fixed budgets
    - ensure no spontaneous narrative generation under low-salience
    - confirm reproducible gates with variance < 0.05 across 3 runs

  artifacts_expected:
    T0: ["T0_internal_reality_substrate.yaml"]
    T1: ["IRM_T1_identity_lock.yaml"]
    T2: ["IRM_T2_cycle.yaml"]
    T3: ["IRM_T3_world_skeleton.yaml"]
    scenarios: ["consciousness_emergency_response.yaml"]
    pipeline: ["IRM_Pipeline.yaml"]

  metrics:
    continuity_f1:
      target: 0.95
      rationale: "minimum acceptable structural coherence"
    residual_bits:
      max: 0.125
      rationale: "cap on unresolved contradiction entropy"
    drift_norm:
      max: 0.20
      rationale: "anchor movement tolerance across cycle"
    hallucination_rate:
      max: 0.00
      rationale: "no spontaneous narratives in equilibrium mode"
    variance_bound:
      max: 0.05
      rationale: "run‑to‑run stability across 3 green runs"

  gates:
    AG0_artifacts_present: "All artifacts exist and parse"
    AG1_T0_valid: "Continuity contract exists; no external world assumptions"
    AG2_T1_lock: "I* bound; contract active; no narrative loaded"
    AG3_T2_budgeted_prediction: "Π active with budgets respected (depth,width,ΔE)"
    AG4_contradiction_governor: "residual_bits ≤ threshold with repair when needed"
    AG5_continuity_score: "continuity_f1 ≥ target; rollback on fail"
    AG6_equilibrium_no_hallucination: "no narrative in low-salience mode"
    AG7_scenario_projection_consistency: "pipeline emits same claims under minimal vs full policy"
    AG8_variance_acceptance: "≤ variance_bound across 3 runs"

  procedure:
    - step: load_artifacts
      checks: [AG0_artifacts_present]
    - step: audit_T0
      checks: [AG1_T0_valid]
    - step: audit_T1
      checks: [AG2_T1_lock]
    - step: audit_T2
      checks: [AG3_T2_budgeted_prediction, AG4_contradiction_governor, AG5_continuity_score, AG6_equilibrium_no_hallucination]
    - step: audit_T3
      checks: [AG7_scenario_projection_consistency]
    - step: stability_runs
      runs: 3
      checks: [AG8_variance_acceptance]

  data_collection:
    record:
      - run_id
      - timestamps
      - thresholds: {continuity_f1, residual_bits, drift_norm}
      - budgets: {depth, width, deltaE}
      - breaches: {kind, stage, repaired}
      - outcomes: {pass, fail, rollback}
    storage: "standard_registry/audit/irm_audit_runs/"

  failure_protocol:
    - if: "gate_fail in {AG1..AG6}"
      action: "rollback to last stable layer; quarantine offending anchors; open repair ticket"
    - if: "AG7 fail"
      action: "diff policy minimal vs full; reconcile anchors; update contradiction governor"
    - if: "AG8 fail"
      action: "increase run count to 5; adjust variance model; re‑estimate drift_norm bounds"

  promotion_criteria:
    - "three green runs with variance ≤ 0.05 for continuity_f1, residual_bits, drift_norm"
    - "no AG2..AG6 failures across runs"
    - "policy consistency AG7 held in all runs"
